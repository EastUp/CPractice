# <center>07.Native层构建java对象<center>
@[TOC](JNI基础)

**代码请看：`08.JNI基础-Native层构建java对象`**

# 知识点：


## 1. 调用 java 层 static 的获取 uuid 的方法

```c
JNIEXPORT void JNICALL Java_com_east_jni08_Sample1_callStaticMethod
(JNIEnv* env,jclass jclz){
	
	// 2. 获取jmethodID
	jmethodID j_mid = (*env)->GetStaticMethodID(env, jclz, "getUUID", "()Ljava/lang/String;");

	// 1. 调用 getUUID 的方法 statics
	jstring j_uuid = (*env)->CallStaticObjectMethod(env,jclz,j_mid);

	// jstring -> c_str
	char* c_uuid = (*env)->GetStringUTFChars(env,j_uuid,NULL);

	// 回收，字符串回收
	(*env)->ReleaseStringChars(env,j_uuid,c_uuid);

	printf("c_uuid = %s",c_uuid);
}
```

## 2. jni 数据类型

- jstring -> java String
- jint -> java int
- jfloat -> java float
- jdouble -> java double
- jobject -> java object
- jintArray -> java int[]


Jni 回收内存：  
`(*env)->ReleaseStringUTFChars(env,j_uuid,c_uuid);`

`签名`:
- String -> Ljava/lang/String;
- Object[] -> [L全类名;
- void -> V
- Long -> J
- Int -> I

## 3. 常量指针和指针常量

- 常量变量：被常量修饰的变量，不能再次被赋值 （Java）
- 常量指针：const 在 * 之前，指针的地址是可以被再次赋值的（可以修改的），指针地址上面的值（变量）是不能被修改的，常量指针的常量是不能被改变的。
- 指针常量：const 在 * 之后，指针的地址是不可以被再次赋值的（不可以修改的），指针地址上面的值（变量）能被修改的，指针常量的指针地址是不能被改变的。

## 4. Native 层构建 Java 对象

```c
// c 层 创建 java 对象
JNIEXPORT jobject JNICALL Java_com_east_jni08_Sample1_createPoint
(JNIEnv* env, jclass jclz){

	// 2. 需要获取 Point 的class name = "全类名"
	// 方法参数上的 jclz  指的是 Sample1.class
	jclass point_clz = (*env)->FindClass(env,"com/east/jni08/Point");

	// 3. 获取jmethodID ,构造方法写死 "<init>"
	jmethodID j_mid = (*env)->GetMethodID(env, point_clz, "<init>","(II)V");

	// 1. 创建对象
	jobject point = (*env)->NewObject(env,point_clz, j_mid, 11, 12);

	// 练习下 y 重新赋值,调用 set 方法
	j_mid = (*env)->GetMethodID(env,point_clz,"setY","(I)V");
	/* va_list 集合
	void (JNICALL *CallVoidMethodV)
	(JNIEnv *env, jobject obj, jmethodID methodID, va_list args);
	// jvalue
	void (JNICALL *CallVoidMethodA)
	(JNIEnv *env, jobject obj, jmethodID methodID, const jvalue * args);
	*/

	(*env)->CallObjectMethod(env,point,j_mid,33);

	// 直接重新赋值，相当于反射了但是比反射快
	jfieldID j_fid = (*env)->GetFieldID(env,point_clz,"y","I");
	(*env)->SetIntField(env,point,j_fid,55);


	return point;
}
```









